CREATE TABLE STATS (
    STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
    STAT_DATE DATETIME NOT NULL,
    STAT VARCHAR(20) NOT NULL,
    VALUE INT(11) NOT NULL
);

CREATE VIEW BESTSELLERS_COUNT AS
SELECT COUNT(*) AS BESTSELLERS FROM BOOKS WHERE BESTSELLER = 1;

DELIMITER $$
CREATE PROCEDURE UPDATE_STATS()
    BEGIN
        DECLARE VALUE INT;
        CALL UpdateBestsellers();
        SELECT BESTSELLERS FROM BESTSELLERS_COUNT
            INTO VALUE;
        INSERT INTO STATS(STAT_DATE, STAT, VALUE)
            VALUES(CURDATE(), 'BESTSELLERS', VALUE);
    END $$
DELIMITER :

CREATE EVENT UPDATE_BESTSELLERS
    ON SCHEDULE EVERY 1 MINUTE
    DO
        CALL UPDATE_STATS();

SHOW PROCESSLIST;